import{a as S}from"./read-DMiUFT0z.js";import{A as w,a as b,s as d}from"./constants-DQWCF818.js";import{s as q}from"./suggestTags-B1X2dEtq.js";import{s as g}from"./logout-Dt4pnz2u.js";import{a as v}from"./authGuard-C2GFzsuy.js";async function A(t,{title:e,body:a,media:s,tags:r}){const l=`${w}/${t}`,n=localStorage.getItem("token"),i={...e&&{title:e},...a&&{body:a},...s&&{media:s},...r.length>0&&{tags:r}},u={"Content-Type":"application/json",Authorization:`Bearer ${n}`,"X-Noroff-API-Key":b};try{const o=await fetch(l,{method:"PUT",headers:u,body:JSON.stringify(i)});if(o.ok)return await o.json();{const c=await o.json();throw new Error(`Failed to update post: ${c.message||o.statusText}`)}}catch(o){throw console.error("Error updating post:",o),o}}g();async function I(t,e){t.preventDefault();const a=t.target,s=a.querySelector("fieldset"),r=a.querySelector("button"),l=r.textContent;s.disabled=!0,r.disabled=!0,r.textContent="Updating post...";const n=document.querySelector("#title").value.trim(),i=document.querySelector("#body").value.trim(),u=document.querySelector("#mediaUrl").value.trim(),o=document.querySelector("#tags").value.trim(),c=o?o.split(",").map(m=>m.trim()):h,h=q(n),P={...n&&{title:n},...i&&{body:i},...u&&{media:{url:u}},...c.length>0&&{tags:c}};try{await A(e,P),d("Post updated successfully!","success")}catch(m){console.error("Error during post update:",m),d("An error occurred while updating the post. Please refresh the page and try again","error")}finally{s.disabled=!1,r.disabled=!1,r.textContent=l}}v();g();async function T(t){try{const e=await S(t);if(p(e),!e){d("The post you're trying to edit does not exist.","info");return}p(e)}catch(e){console.error("Error loading post data:",e),d("Failed to load post data.","error")}}function p(t){var e;document.querySelector("#title").value=t.title||"",document.querySelector("#body").value=t.body||"",document.querySelector("#mediaUrl").value=((e=t.media)==null?void 0:e.url)||"",document.querySelector("#tags").value=t.tags.join(",")}const E=new URLSearchParams(window.location.search),y=E.get("id");T(y);const f=document.getElementById("edit-post-form");f?f.addEventListener("submit",t=>{t.preventDefault(),I(t,y)}):d("Oops! We could not find a form on the page. Please refresh the page and try again","info");
