import{a as C}from"./authGuard-C2GFzsuy.js";import{b as w}from"./read-DMiUFT0z.js";import{A as P,a as g,s as h,b as v}from"./constants-DQWCF818.js";import{s as S}from"./logout-Dt4pnz2u.js";import{s as E,h as y}from"./skeletonLoader-C84aKAOy.js";async function k(n){const s=`${P}/${n}`,t={"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`,"X-Noroff-API-Key":g};try{const o=await fetch(s,{method:"DELETE",headers:t});if(o.ok)return;{const a=await o.json();throw new Error(a.message||"Failed to delete post")}}catch(o){throw console.error("Failed to delete post",o),o}}async function A(n,s){n.preventDefault();const e=document.getElementById("delete-modal");e.classList.remove("hidden"),document.getElementById("cancel-btn").addEventListener("click",()=>{e.classList.add("hidden")}),document.getElementById("confirm-btn").addEventListener("click",async()=>{try{await k(s),h("Your post was successfully deleted!","success"),window.location.reload()}catch(t){console.error("Error during post deletion:",t),h("An error occurred while deleting the post. Please try again.","error")}finally{e.classList.add("hidden")}})}async function I(n){const s=`${v}/${n}`,t={"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`,"X-Noroff-API-Key":g};try{const o=await fetch(s,{method:"GET",headers:t});if(o.ok){const{data:a}=await o.json();return a}else{const a=await o.json();throw new Error(a.message||"Failed to fetch author profile")}}catch(o){throw console.error("Failed to fetch profile details",o),o}}C();S();async function b(){var o,a;E();const n=JSON.parse(localStorage.getItem("user")),s=n==null?void 0:n.name,e=document.querySelector("#profile-image"),t=document.querySelector("#username-info");try{const r=await I(s);t.textContent=`${r==null?void 0:r.name}'s Profile`;const d=document.createElement("img");d.src=((o=r.avatar)==null?void 0:o.url)||"/images/default-avatar.png",d.alt=((a=r.avatar)==null?void 0:a.alt)||"Default profile avatar",d.classList.add("profile-avatar"),e.innerHTML="",e.appendChild(d)}catch(r){console.error("Error fetching profile data:",r),t.textContent="Unable to load username.",e.textContent="Avatar not available."}finally{y()}}b();async function x(){E();const n=document.querySelector("#user-posts");try{const{data:s}=await w(12,1);s.forEach(e=>{var f;const t=document.createElement("div");t.classList.add("user-post");const o=document.createElement("img");o.src=((f=e.media)==null?void 0:f.url)||"/images/default-post-image.png",o.alt=e.title||"Post image",o.classList.add("user-post-image"),t.appendChild(o);const a=document.createElement("h3");a.textContent=e.title,a.classList.add("user-post-title"),t.appendChild(a);const r=document.createElement("p"),d=e.body?e.body.slice(0,100)+"...":"No content available";r.textContent=d,r.classList.add("user-post-snippet"),t.appendChild(r);const m=document.createElement("p"),L=new Date(e.created);m.textContent=`Posted ${L.toLocaleDateString()}`,m.classList.add("user-post-date"),t.appendChild(m);const c=document.createElement("div");if(c.classList.add("snippet-post-tags"),Array.isArray(e.tags)&&e.tags.length>0)e.tags.forEach(i=>{const u=document.createElement("span");u.textContent=i,u.classList.add("snippet-post-tag-item"),c.appendChild(u)});else{const i=document.createElement("span");i.textContent="No tagsðŸ¥²",i.classList.add("snippet-post-no-tags"),c.appendChild(i)}t.appendChild(c);const l=document.createElement("button");l.textContent="Edit",l.classList.add("edit-button"),l.addEventListener("click",i=>{i.stopPropagation(),window.location.href=`/post/edit/?id=${e.id}`}),t.appendChild(l);const p=document.createElement("button");p.textContent="Delete",p.classList.add("delete-button"),p.addEventListener("click",i=>{i.stopPropagation(),A(i,e.id,t)}),t.appendChild(p),t.addEventListener("click",()=>{window.location.href=`/post/?id=${e.id}`}),n.appendChild(t)})}catch(s){h("Error fetching posts:"+s.message,"error")}finally{y()}}x();
